import{createClient as m}from"https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=r(e);fetch(e.href,o)}})();const p="https://dbhjxlepxehsfdsbvbul.supabase.co",h="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRiaGp4bGVweGVoc2Zkc2J2YnVsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkzMDM0MTcsImV4cCI6MjA4NDg3OTQxN30.JN5dL_mzP4NQTSvj-A2C-ZhP8hT1iZcwhgRPqcZw46Y",a=m(p,h),y=document.getElementById("importForm"),u=document.getElementById("status"),l=document.getElementById("submitBtn"),f=document.getElementById("videosList");async function d(){try{const{data:s,error:t}=await a.from("facebook_reels").select("*").eq("is_active",!0).order("order_index",{ascending:!0});if(t)throw t;if(!s||s.length===0){f.innerHTML='<div class="empty-state">Пока нет видео. Добавьте первое!</div>';return}f.innerHTML=s.map(r=>`
          <div class="video-item">
            <div class="video-info">
              <div class="video-title">${r.title}</div>
              <div class="video-url">${r.url}</div>
            </div>
            <button class="delete-btn" onclick="deleteVideo('${r.id}')">Удалить</button>
          </div>
        `).join("")}catch(s){console.error("Ошибка загрузки видео:",s)}}window.deleteVideo=async function(s){if(confirm("Удалить это видео?"))try{const{error:t}=await a.from("facebook_reels").delete().eq("id",s);if(t)throw t;i("Видео удалено","success"),await d()}catch(t){i("Ошибка удаления: "+t.message,"error")}};y.addEventListener("submit",async s=>{s.preventDefault();const t=document.getElementById("urls").value.split(`
`).map(r=>r.trim()).filter(r=>r&&r.startsWith("http"));if(t.length===0){i("Пожалуйста, вставьте хотя бы одну ссылку","error");return}l.disabled=!0,l.textContent="Добавляю...";try{let r=0,n=0;for(let e=0;e<t.length;e++){i(`Добавляю ${e+1} из ${t.length}...`,"info");const{data:o,error:c}=await a.from("facebook_reels").upsert({url:t[e],title:`Заботливый дом - видео ${e+1}`,description:"Умный дом для заботы о близких",order_index:e+1,is_active:!0},{onConflict:"url"}).select();c?(n++,console.error("Ошибка:",c)):r++}n>0?i(`Добавлено: ${r}, Ошибок: ${n}`,"error"):(i(`✅ Успешно добавлено ${r} видео!`,"success"),document.getElementById("urls").value=""),await d()}catch(r){i("Ошибка: "+r.message,"error")}finally{l.disabled=!1,l.textContent="Добавить видео"}});function i(s,t){u.textContent=s,u.className="status "+t}d();
